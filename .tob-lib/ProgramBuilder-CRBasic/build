#!/usr/local/bin/bash

warn() { printf "%s\n" "$@" >&2; }
error() { printf "%s\n" "$@" >&2; exit 1; }

main() {
    local site
    local -a chunks=(
        constants-table
        constants
        globals
        datatables
        functions
        subs
        programs
    )

    export BUILD_SHOW_ID=
    while [[ ${1:0:1} == "-" ]]; do
        case "$1" in
        --show-id | --show-ids) export BUILD_SHOW_ID=1 ;;
        --chunk | --chunks)     chunks=($2); shift ;;
        --help)                 awk '/^NAME/,/EOF/{print}' $0; exit ;; 
        -h)                     awk '/^SYNOPSIS/{getline;print}' $0; exit ;; 
        *)                      error "unknown option: $1" ;;
        esac
        shift
    done

    site="$1" && shift

    for chunk in "${chunks[@]}"; do  
        $chunk $site "$@"
    done
}

main "$@"

exit

NAME
    ProgramBuilder-CRBasic.build

SYNOPSIS
    build [--help] [--show-id] [--chunk CHUNK1[" CHUNK2"...]] BUILDER-OBJECT

AUTHOR
    ken.irving@alaska.edu 2011-2018
